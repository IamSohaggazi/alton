/* ===============================================================================
 * featured-scroll.js v1.0
 * ===============================================================================
 * Copyright 2014 Paper Leaf Design
 * http://www.paper-leaf.com
 * 
 * Author: Paper Leaf
 *
 * A full featured scrolling plugin for creating
 * immersive featured sections or headers.
 *
 * Credit: 
 * is_mobile() based off these helpful posts
 * - http://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-handheld-device-in-jquery
 * 
 * Getting stable scroll events was helped hugely by Huge Inc's insights
 * - http://www.hugeinc.com/ideas/perspective/scroll-jacking-on-hugeinc
 *
 * Stabilizing keypress events was helped in large part by jQuery OnePage Scroll
 * - https://github.com/peachananr/onepage-scroll
 * 
 * License: GPL v3
 * =============================================================================== */(function(e){"use strict";var t={firstClass:"header",fullSlideClass:"full",nextElement:"div",previousClass:null,lastClass:"footer",slideNumbersContainer:"slide-numbers",bodyContainer:"pageWrapper",scrollMode:"featuredScroll",useSlideNumbers:!1,slideNumbersBorderColor:"#fff",slideNumbersColor:"#000",animationType:"slow"};e.fn.scrollJack=function(n){function x(t){if(t==="featuredScroll"){for(S=s.length-1;S>=0;S-=1)e(s[S]).css("height",E+10);if(r.useSlideNumbers){e("."+r.bodyContainer).append('<div style="height: 100%;position: fixed;top: 0;right: 0px;bottom: 0px;width: 86px;z-index: 999;" id="'+r.slideNumbersContainer+'"></div>');e("."+r.bodyContainer+" #"+r.slideNumbersContainer).append('<ul style="transform: translateY(-50%);-moz-transform: translateY(-50%);-ms-transform: translateY(-50%);-o-transform: translateY(-50%);-webkit-transform: translateY(-50%);top: 50%;position: fixed;"></ul>');var n=0;while(n<d){e("."+r.bodyContainer+" #"+r.slideNumbersContainer+" ul").append('<li class="paginate" style="cursor:pointer;border-radius:50%;list-style: none;background: '+r.slideNumbersBorderColor+";border:2px solid "+r.slideNumbersBorderColor+';border-radius: 50%;height: 10px;width: 10px;margin: 5px 0;"></ul>');n+=1}v=document.getElementsByClassName("paginate")}}else{e("."+r.firstClass).css("height",E+10);e("."+r.firstClass).hasClass("active")||e("."+r.firstClass).toggleClass("active")}}function T(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|Windows Phone|Tizen|Bada)/)}function N(t,n){if(n){if(e(v[e(t).parent().children().index(t)]).hasClass("active")){e(v[e(t).parent().children().index(t)]).toggleClass("active");e(v[e(t).parent().children().index(t)]).css("background",r.slideNumbersBorderColor)}}else if(!e(v[e(t).parent().children().index(t)]).hasClass("active")){e(v[e(t).parent().children().index(t)]).toggleClass("active");e(v[e(t).parent().children().index(t)]).css("background",r.slideNumbersColor)}}function C(t){r.useSlideNumbers&&(t?e("#"+r.slideNumbersContainer).fadeIn():e("#"+r.slideNumbersContainer).fadeOut())}function k(t){var n=document.getElementsByClassName(i);e(document).scrollTo(e(n[t]));l=n[t];e(l).prev().hasClass(i)?h=e(l).prev():h=e("."+r.firstClass);e(l).next().hasClass(i)?c=e(l).next():c=e("."+r.lastClass);e(".paginate").each(function(){e(this).hasClass("active")&&e(this).toggleClass("active")});N(n[t],!1)}function L(){if(e(window).scrollTop()>=c.offset().top)e("."+i).each(function(){var t=e(this).offset().top;if(t===e(window).scrollTop()-28){e(this).prev().hasClass(i)?h=e(this).prev():h=e("."+r.firstClass);l=e(this);e(this).next().hasClass(i)?c=e(this).next():c=e("."+r.lastClass);g=!1;N(l,!1)}});else{C(!1);e(document).scrollTo(l)}}function A(e){e.preventDefault(e);e.stopPropagation();return!1}function O(t){o=e("body,html").is(":animated");a=!1;f=!1;if(t.originalEvent.wheelDelta/3>=1&&u!==!0||t.originalEvent.wheelDelta/3<=-1&&u!==!0||t.originalEvent.detail/3>=1&&u!==!0||t.originalEvent.detail/3<=1&&u!==!0){u=!0;clearTimeout(m);m=setTimeout(function(){u=!1;a=!1;f=!1;b=0;y=0},1500);e("html, body").off("DOMMouseScroll",!1);e("html, body").off("mousewheel",!1)}if(t.originalEvent.detail/3>=1&&!a&&b<1||t.originalEvent.wheelDelta/3<=-1&&!a&&b<1){b+=1;e(document).moveUp(t)}else if(t.originalEvent.detail/3<=-1&&!f&&y<1||t.originalEvent.wheelDelta/3>=1&&!f&&y<1){y+=1;e(document).moveDown(t)}return A(t)}function M(t){if(t.originalEvent.detail>0||t.originalEvent.wheelDelta<0){if(!(e(c).offset().top>0&&e(window).scrollTop()<e("."+r.firstClass).height()))return!0;if(e("."+r.firstClass).hasClass("active")){e("."+r.firstClass).toggleClass("active");e(document).scrollTo(c);h=l;l=c;return A(t)}if(!e("html, body").is(":animated"))return!0}else if(!e("."+r.firstClass).hasClass("active")&&e(window).scrollTop()<=e("."+r.firstClass).height()){e("."+r.firstClass).toggleClass("active");e(document).scrollTo(h);c=l;l=h}else if(!e("html, body").is(":animated"))return!0;return!1}var r=e.extend(!0,{},t,n),i=e("."+r.fullSlideClass+" "+r.nextElement).attr("class"),s=document.getElementsByClassName(i),o,u,a=!1,f=!1,l=e("."+r.firstClass),c=e("."+i+":first"),h=null,p=e("."+r.lastClass),d=e("."+r.fullSlideClass).children().length,v,m,g=!0,y=0,b=0,w=e(window).scrollTop(),E=e(window).height(),S;r.scrollMode==="headerScroll"&&(l=e("."+r.firstClass),c=e("."+r.bodyContainer+":first"));e.fn.moveUp=function(t){if(e(window).scrollTop()>=0&&e(window).scrollTop()<=e(l).scrollTop()&&g===!0){h=l;l=c;c=l.next();if(r.useSlideNumbers){N(l,!1);C(!0)}g=!1;e(document).scrollTo(l);return A(t)}if(!o&&c&&e(l).offset().top<e(window).scrollTop()+1){if(c.hasClass(i)){h=l;l=c;c=e(l).next();if(r.useSlideNumbers){N(h,!0);N(l,!1);C(!0)}e(document).scrollTo(l);return A(t)}h=e("."+i+":last");l=p;c=null;if(e(window).scrollTop()+E+10>=e(document).height()-e(".ctas").height()&&r.useSlideNumbers){N(h,!1);C(!1)}e(document).scrollTo(l);return A(t)}};e.fn.moveDown=function(t){if(e("."+r.fullSlideClass).offset().top+1>e(window).scrollTop()&&h&&e(window).scrollTop()>0){if(e(l).offset().top>=e(window).scrollTop()){l=e("."+r.firstClass);h=null;c=e("."+i);if(r.useSlideNumbers){C(!1);N(c,!0)}g=!0}else{l=h;h=null;c=e("."+i);if(r.useSlideNumbers){N(l,!0);N(h,!0)}}e(document).scrollTo(l);return A(t)}if(!o&&e("."+r.fullSlideClass).offset().top<e(window).scrollTop()){l=h;h=e(l).prev();c=e(l).next();if(r.useSlideNumbers){N(l,!1);N(c,!0);C(!0)}e(document).scrollTo(l);return A(t)}f=!0;a=!1;return A(t)};e.fn.scrollTo=function(t){t!==p?e("body,html").stop(!0,!0).animate({scrollTop:e(t).offset().top,easing:r.animationType}):e("body,html").stop(!0,!0).animate({scrollTop:e(document).height()-E,easing:r.animationType})};e(document).ready(function(){x(r.scrollMode);r.scrollMode==="featuredScroll"&&L();if(r.scrollMode==="featuredScroll"){e("#slide-numbers li").on("click",function(){k(e(this).parent().children().index(this))});e(document).keydown(function(t){switch(t.which){case 40:e(document).moveUp();break;case 33:e(document).moveUp();break;case 34:e(document).moveDown();break;case 38:e(document).moveDown();break;case 50:e(document).scrollTo("."+r.firstClass);break;case 49:e(document).scrollTo(p)}})}!T()&&r.scrollMode==="featuredScroll"?e(document).on({"DOMMouseScroll mousewheel":O}):!T()&&r.scrollMode==="headerScroll"&&e(document).on({"DOMMouseScroll mousewheel":M})})}})(jQuery);