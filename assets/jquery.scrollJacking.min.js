/* ===============================================================================
 * featured-scroll.js v1.0
 * ===============================================================================
 * Copyright 2014 Paper Leaf Design
 * http://www.paper-leaf.com
 * 
 * Author: Paper Leaf
 *
 * A full featured scrolling plugin for creating
 * immersive featured sections or headers.
 *
 * Credit: 
 * is_mobile() based off these helpful posts
 * - http://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-handheld-device-in-jquery
 * 
 * Getting stable scroll events was helped hugely by Huge Inc's insights
 * - http://www.hugeinc.com/ideas/perspective/scroll-jacking-on-hugeinc
 *
 * Stabilizing keypress events was helped in large part by jQuery OnePage Scroll
 * - https://github.com/peachananr/onepage-scroll
 * 
 * License: GPL v3
 * =============================================================================== */(function(e){"use strict";var t={firstClass:"header",fullSlideClass:"full",nextElement:"div",previousClass:null,lastClass:"footer",slideNumbersContainer:"slide-numbers",bodyContainer:"pageWrapper",scrollMode:"featuredScroll",useSlideNumbers:!1,slideNumbersBorderColor:"#fff",slideNumbersColor:"#000",animationType:"slow"};e.fn.scrollJack=function(n){function C(t){if(t==="featuredScroll"){for(N=s.length-1;N>=0;N-=1)e(s[N]).css("height",w+10);if(r.useSlideNumbers){e("."+r.bodyContainer).append('<div id="'+r.slideNumbersContainer+'"></div>');e("#"+r.slideNumbersContainer).css({height:"100%",position:"fixed",top:0,right:"0px",bottom:"0px",width:"86px","z-index":999});e("."+r.bodyContainer+" #"+r.slideNumbersContainer).append("<ul></ul>");e("."+r.bodyContainer+" #"+r.slideNumbersContainer+" ul").css({transform:"translateY(-50%)","-moz-transform":"translateY(-50%)","-ms-transform":"translateY(-50%)","-o-transform":"translateY(-50%)","-webkit-transform":"translateY(-50%)",top:"50%",position:"fixed"});var n=0;while(n<d){e("."+r.bodyContainer+" #"+r.slideNumbersContainer+" ul").append('<li class="paginate"></ul>');e(".paginate").css({cursor:"pointer","border-radius":"50%","list-style":"none",background:r.slideNumbersBorderColor,border:"2px solid"+r.slideNumbersBorderColor,height:"10px",width:"10px",margin:"5px 0"});n+=1}v=document.getElementsByClassName("paginate")}}else{e("."+r.firstClass).css("height",w+10);e("."+r.firstClass).hasClass("active")||e("."+r.firstClass).toggleClass("active")}}function k(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|Windows Phone|Tizen|Bada)/)}function L(t,n){if(n){if(e(v[e(t).parent().children().index(t)]).hasClass("active")){e(v[e(t).parent().children().index(t)]).toggleClass("active");e(v[e(t).parent().children().index(t)]).css("background",r.slideNumbersBorderColor)}}else if(!e(v[e(t).parent().children().index(t)]).hasClass("active")){e(v[e(t).parent().children().index(t)]).toggleClass("active");e(v[e(t).parent().children().index(t)]).css("background",r.slideNumbersColor)}}function A(t){r.useSlideNumbers&&(t?e("#"+r.slideNumbersContainer).fadeIn():e("#"+r.slideNumbersContainer).fadeOut())}function O(t){var n=document.getElementsByClassName(i);e(document).scrollTo(e(n[t]));l=n[t];e(l).prev().hasClass(i)?h=e(l).prev():h=e("."+r.firstClass);e(l).next().hasClass(i)?c=e(l).next():c=e("."+r.lastClass);L(e("#"+r.slideNumbersContainer+" li.active"),!0);L(n[t],!1)}function M(){if(e(window).scrollTop()>=c.offset().top&&e(window).scrollTop()+e(window).height()!==e(document).height()){var t;e("."+i).each(function(){t=e(this).offset().top;if(t<=e(window).scrollTop()){e(this).prev().hasClass(i)?h=e(this).prev():h=e("."+r.firstClass);l=e(this);l.next().hasClass(i)?c=e(this).next():c=e("."+r.lastClass);g=!1}});L(l,!1)}else{A(!1);e(document).scrollTo(l)}}function D(e){e=e||window.event;if(e.preventDefault){e.stopPropagation();e.returnValue=!1}}function P(e){return D(e)}function H(){return window.pageYOffset||S.scrollTop}function B(t){o=e("body,html").is(":animated")||e("body").is(":animated")||e("html").is(":animated");clearTimeout(e.data(this,"scrollTimer"));e.data(this,"scrollTimer",setTimeout(function(){E=!1},50));if(t.originalEvent.detail/3>=1&&!E||t.originalEvent.wheelDelta/3<=-1&&!E){b+=1;e(document).moveDown();E=!0}else if(t.originalEvent.detail/3<=-1&&!E||t.originalEvent.wheelDelta/3>=1&&!E){y+=1;e(document).moveUp();E=!0}return!1}function j(t){x=H();if(t.originalEvent.detail>0||t.originalEvent.wheelDelta<0){if(!(e(c).offset().top>0&&x<e("."+r.firstClass).height()))return!0;if(e("."+r.firstClass).hasClass("active")){e("."+r.firstClass).toggleClass("active");e(document).scrollTo(c);h=l;l=c;return P(t)}if(!e("html, body").is(":animated"))return!0}else if(!e("."+r.firstClass).hasClass("active")&&e(window).scrollTop()<=e("."+r.firstClass).height()){e("."+r.firstClass).toggleClass("active");e(document).scrollTo(h);c=l;l=h}else if(!e("html, body").is(":animated"))return!0;return!1}var r=e.extend(!0,{},t,n),i=e("."+r.fullSlideClass+" "+r.nextElement).attr("class"),s=document.getElementsByClassName(i),o,u,a=!1,f=!1,l=e("."+r.firstClass),c=e("."+i+":first"),h=null,p=e("."+r.lastClass),d=e("."+r.fullSlideClass).children().length,v,m,g=!0,y=0,b=0,w=e(window).height(),E=!1,S=window.document.documentElement,x,T,N;r.scrollMode==="headerScroll"&&(l=e("."+r.firstClass),c=e("."+r.bodyContainer+":first"));var _=[37,38,39,40];e.fn.moveDown=function(t){x=H();if(x>=0&&x<=e(l).scrollTop()&&g===!0){h=l;l=c;c=l.next();if(r.useSlideNumbers){L(l,!1);A(!0)}g=!1;e(document).scrollTo(l)}else if(!o&&c&&e(l).offset().top<x+1)if(c.hasClass(i)){h=l;l=c;c=e(l).next();if(r.useSlideNumbers){L(h,!0);L(l,!1)}e(document).scrollTo(l)}else{h=e("."+i+":last");l=p;c=null;if(e(window).scrollTop()+w+10>=e(document).height()-e(p).height()&&r.useSlideNumbers){L(h,!1);A(!1)}e(document).scrollTo(l)}};e.fn.moveUp=function(t){x=H();if(e("."+r.fullSlideClass).offset().top+1>x&&h&&x>0){if(e(l).offset().top>=x){l=e("."+r.firstClass);h=null;c=e("."+i);if(r.useSlideNumbers){A(!1);L(c,!1)}g=!0}else{l=h;h=null;c=e("."+i);if(r.useSlideNumbers){L(l,!0);L(h,!0)}}e(document).scrollTo(l)}else if(!o&&e("."+r.fullSlideClass).offset().top<x){l=h;h=e(l).prev();c=e(l).next();if(r.useSlideNumbers){L(l,!1);L(c,!0);A(!0)}e(document).scrollTo(l)}f=!0;a=!1};e.fn.scrollTo=function(t){t!==p?e("body,html").stop(!0,!0).animate({scrollTop:e(t).offset().top,easing:r.animationType}):e("body,html").stop(!0,!0).animate({scrollTop:e(document).height()-w,easing:r.animationType})};e(document).ready(function(){C(r.scrollMode);r.scrollMode==="featuredScroll"&&M();if(r.scrollMode==="featuredScroll"){e("#"+r.slideNumbersContainer+" li").on("click",function(){O(e(this).parent().children().index(this))});e(document).keydown(function(t){switch(t.which){case 40:e(document).moveDown(t);break;case 33:e(document).moveDown(t);break;case 34:e(document).moveUp(t);break;case 38:e(document).moveUp(t);break;case 50:e(document).scrollTo("."+r.firstClass);break;case 49:e(document).scrollTo(p)}})}!k()&&r.scrollMode==="featuredScroll"?e(document).on({"DOMMouseScroll mousewheel":B}):!k()&&r.scrollMode==="headerScroll"&&e(document).on({"DOMMouseScroll mousewheel":j})})}})(jQuery);