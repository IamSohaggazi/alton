/* ===============================================================================
 * featured-scroll.js v1.0
 * ===============================================================================
 * Copyright 2014 Paper Leaf Design
 * http://www.paper-leaf.com
 * 
 * Author: Paper Leaf
 *
 * A full featured scrolling pluding for creating
 * immersive featured sections or headers.
 *
 * Credit: 
 * is_mobile() based off these helpful posts
 * - http://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-handheld-device-in-jquery
 * 
 * Getting stable scroll events was helped hugely by Huge Inc's insights
 * - http://www.hugeinc.com/ideas/perspective/scroll-jacking-on-hugeinc
 *
 * Stabilizing keypress events was helped in large part by jQuery OnePage Scroll
 * - https://github.com/peachananr/onepage-scroll
 * 
 * License: GPL v3
 * =============================================================================== *//* ===============================================================================
 * Table of Contents
 * -------------------
 * 
 * 1. Default Options
 * 2. Global Variables
 * 3. Initiate Layout
 * 4. Mobile Device Check
 * 5. Click to Navigate
 * 6. Update Position
 * 7. Move Up
 * 8. Move Down
 * 9. Prevent Default Animations
 * 10. Scroll To
 * 11. Featured Scroll
 * 12. Header Scroll
 * 
 * =============================================================================== */(function(e){"use strict";var t={firstClass:"header",fullSlideClass:"full",nextElement:"div",previousClass:null,lastClass:"footer",slideNumbersContainer:"slide-numbers",bodyContainer:"pageWrapper",scrollMode:"featuredScroll"};e.fn.scrollJack=function(n){function x(){for(S=s.length-1;S>=0;S-=1)e(s[S]).css("height",E+10);e("#"+r.bodyContainer).append('<div id="'+r.slideNumbersContainer+'"></div>');e("#"+r.bodyContainer+" #"+r.slideNumbersContainer).append("<ul></ul>");var t=0;while(t<d){e("#"+r.bodyContainer+" #"+r.slideNumbersContainer+" ul").append('<li class="paginate" style="cursor:pointer;"></ul>');t+=1}v=document.getElementsByClassName("paginate")}function T(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|Windows Phone|Tizen|Bada)/)}function N(t,n){n?e(v[e(t).parent().children().index(t)]).hasClass("active")&&e(v[e(t).parent().children().index(t)]).toggleClass("active"):e(v[e(t).parent().children().index(t)]).hasClass("active")||e(v[e(t).parent().children().index(t)]).toggleClass("active")}function C(t){t?e("#"+r.slideNumbersContainer).fadeIn():e("#"+r.slideNumbersContainer).fadeOut()}function k(t){var n=document.getElementsByClassName(i);e(document).scrollTo(e(n[t]));o=n[t];e(o).prev().hasClass(i)?a=e(o).prev():a=e("."+r.firstClass);e(o).next().hasClass(i)?u=e(o).next():u=e("."+r.lastClass);e(".paginate").each(function(){e(this).hasClass("active")&&e(this).toggleClass("active")});N(n[t],!1)}function L(){if(e(window).scrollTop()>=u.offset().top)e("."+i).each(function(){var t=e(this).offset().top;if(t===e(window).scrollTop()-28){e(this).prev().hasClass(i)?a=e(this).prev():a=e("."+r.firstClass);o=e(this);e(this).next().hasClass(i)?u=e(this).next():u=e("."+r.lastClass);g=!1;N(o,!1)}});else{C(!1);e(document).scrollTo(o)}}function A(e){e.preventDefault();e.stopPropagation()}function O(t){l=e("body,html").is(":animated");h=!1;p=!1;if(t.originalEvent.wheelDelta/3>=1&&c!==!0||t.originalEvent.wheelDelta/3<=-1&&c!==!0||t.originalEvent.detail/3>=1&&c!==!0||t.originalEvent.detail/3<=1&&c!==!0){c=!0;clearTimeout(m);m=setTimeout(function(){c=!1;h=!1;p=!1;b=0;y=0},1500);e("html, body").off("DOMMouseScroll",!1);e("html, body").off("mousewheel",!1)}if(t.originalEvent.detail/3>=1&&!h&&b<1||t.originalEvent.wheelDelta/3<=-1&&!h&&b<1){b+=1;e(document).moveUp()}else if(t.originalEvent.detail/3<=-1&&!p&&y<1||t.originalEvent.wheelDelta/3>=1&&!p&&y<1){y+=1;e(document).moveDown()}return!1}var r=e.extend(!0,{},t,n),i=e("."+r.fullSlideClass+" "+r.nextElement).attr("class"),s=document.getElementsByClassName(i),o=e("."+r.firstClass),u=e("."+i+":first"),a=null,f=e("."+r.lastClass),l,c,h=!1,p=!1,d=e("."+r.fullSlideClass).children().length,v,m,g=!0,y=0,b=0,w=e(window).scrollTop(),E=e(window).height(),S;e.fn.moveUp=function(){if(e(window).scrollTop()>=0&&e(window).scrollTop()<=e(o).scrollTop()&&g===!0){a=o;o=u;u=o.next();A(event);N(o,!1);C(!0);g=!1;e(document).scrollTo(o)}else if(!l&&u&&e(o).offset().top<e(window).scrollTop()+1)if(u.hasClass(i)){a=o;o=u;u=e(o).next();N(a,!0);N(o,!1);C(!0);e(document).scrollTo(o)}else{a=e("."+i+":last");o=f;u=null;if(e(window).scrollTop()+E+10>=e(document).height()-e(".ctas").height()){N(a,!1);C(!1)}e(document).scrollTo(o)}};e.fn.moveDown=function(){if(e("."+r.fullSlideClass).offset().top+1>e(window).scrollTop()&&a&&e(window).scrollTop()>0){if(e(o).offset().top>=e(window).scrollTop()){o=e("."+r.firstClass);a=null;u=e("."+i);C(!1);N(u,!0);g=!0}else{o=a;a=null;u=e("."+i);N(o,!0);N(a,!0)}A(event);e(document).scrollTo(o)}else if(!l&&e("."+r.fullSlideClass).offset().top<e(window).scrollTop()){o=a;a=e(o).prev();u=e(o).next();N(o,!1);N(u,!0);C(!0);e(document).scrollTo(o);A(event)}p=!0;h=!1;A(event)};e.fn.scrollTo=function(t){t!==f?e("body,html").stop(!0,!0).animate({scrollTop:e(t).offset().top},"slow"):e("body,html").stop(!0,!0).animate({scrollTop:e(document).height()-E},"slow")};e(document).ready(function(){x();L();if(r.scrollMode==="featuredScroll"){e("#slide-numbers li").on("click",function(){k(e(this).parent().children().index(this))});e(document).keydown(function(t){switch(t.which){case 40:e(document).moveUp();break;case 33:e(document).moveUp();break;case 34:e(document).moveDown();break;case 38:e(document).moveDown();break;case 50:e(document).scrollTo("."+r.firstClass);break;case 49:e(document).scrollTo(f)}});T()||e(document).on({"DOMMouseScroll mousewheel":O})}})}})(jQuery);